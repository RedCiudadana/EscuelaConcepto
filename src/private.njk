<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EscuelaConcepto</title>

  <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
  <h1>Private</h1>
  <h2 id="loading-state">Loading...</h2>
  <script>
    async function loadContent() {
      window.netlifyIdentity.init();
      const user = window.netlifyIdentity.currentUser();

      console.log(user);

      if (!user) {
        console.log('Not user');
        document.getElementById('loading-state').innerText = 'Debes iniciar sesi√≥n para ver este contenido. <a href="/">Inicio</a>';
        return;
      }

      console.log('generate jwt token');
      user.jwt().then((token) => {
        fetch('/.netlify/functions/private_content', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        }).then((response) => console.log(response));
      })
    }

    loadContent();
  </script>
</body>

</html>